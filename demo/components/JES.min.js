/*! JES - v0.1.0 - 2014-01-07
* Copyright (c) 2014 Kevin Selwyn; Licensed GPLv3 */
!function(){"use strict";var a={sbox:{norm:[],inv:[]},matrix:{norm:[[2,3,1,1],[1,2,3,1],[1,1,2,3],[3,1,1,2]],inv:[[14,11,13,9],[9,14,11,13],[13,9,14,11],[11,13,9,14]]},rcon:[141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154],error:function(a){var b,c=[],d="",e=0,f=0,g=0;for(e in a)if(a.hasOwnProperty(e))for(b=a[e].variable,c=a[e].conditions,d=a[e].message,f=0,g=c.length;g>f;f+=1)if(b===c[f])return console.warn(d),!0;return!1},clone:function(b){var c=b instanceof Array?[]:{},d=0;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]&&"object"==typeof b[d]?a.clone(b[d]):b[d]);return c},blockXOR:function(){var a=arguments,b=this.clone(a[0]),c=0,d=0,e=0,f=0;if(a.length<2)return a;for(e=0;e<b.length;e+=1)for(f=0;f<b[e].length;f+=1)for(c=1,d=a.length;d>c;c+=1)b[e][f]^=a[c][e][f];return b},output:function(a,b){var c=[],d="",e=0,f=0;switch(b=b||"ascii/string"){case"hex/array":for(e=0,f=a.length;f>e;e+=1)d=parseInt(a[e],10).toString(16),c.push(d.length<2?"0"+d:d);return c;case"hex/string":for(e=0,f=a.length;f>e;e+=1)d=parseInt(a[e],10).toString(16),c.push(d.length<2?"0"+d:d);return c.join("");case"ascii/array":for(e=0,f=a.length;f>e;e+=1)c.push(String.fromCharCode(a[e]));return c;case"int/array":return a;default:for(e=0,f=a.length;f>e;e+=1)c.push(String.fromCharCode(a[e]));return c.join("")}},subBytes:function(a,b){var c=b?this.sbox.inv:this.sbox.norm,d=0,e=0;for(d=0;d<a.length;d+=1)for(e=0;e<a[d].length;e+=1)a[d][e]=c[a[d][e]];return a},shiftRows:function(a,b){var c=[],d=0;for(b=b?a.length:0,d=0;d<a.length;d+=1)c=a[d].splice(Math.abs(b-d),a.length),a[d]=c.concat(a[d]);return a},mixColumns:function(a,b){var c=b?this.matrix.inv:this.matrix.norm,d=function(a,b){var c=0,d=0,e=0;for(e=0;8>e;e+=1)d^=1===(1&b)?a:0,c=128&a,a<<=1,a^=128===c?27:0,b>>=1;return d%256},e=0,f=[],g=0,h=0,i=0;for(i=0;i<a.length;i+=1)for(g=0;g<c.length;g+=1){for(e=0,h=0;h<a.length;h+=1)e^=d(a[h][i],c[g][h]);f.push(e)}for(g=0,i=0;i<a.length;i+=1)for(h=0;h<a.length;h+=1)a[h][i]=f[g],g+=1;return a},addRoundKey:function(a,b){return this.blockXOR(a,b)},keySchedule:function(a,b){var c=[],d=[],e=[],f=[],g=[0,0,0,0],h=[],i=[],j=0,k=0,l=0,m=0,n=0;for(c.push(a),j=1;b>=j;j+=1){for(a=c[j-1],d=[[],[],[],[]],e=[],f=[],g=[this.rcon[j%255],0,0,0],h=[[],[],[],[]],i=[[],[],[],[]],m=0;m<a.length;m+=1)for(n=0;n<a.length;n+=1)d[m].push(a[n][m]);for(e=d[3].slice(0),f=e.splice(1,e.length-1),e=f.concat(e),e=this.subBytes([e])[0],k=0;k<d[0].length;k+=1)h[0][k]=d[0][k]^e[k]^g[k];for(k=1;k<d.length;k+=1)for(l=0;l<d[k].length;l+=1)h[k][l]=d[k][l]^h[k-1][l];for(m=0;m<h.length;m+=1)for(n=0;n<h[m].length;n+=1)i[m][n]=h[n][m];c.push(i)}return c},toKey:function(a){for(var b=[[],[],[],[]],c=[],d="0",e=0,f=0,g=0,h=0;a.length<32;)a+=d;for(a=a.substring(0,32),e=0,f=a.length;f>e;e+=2)c.push(parseInt(a.substring(e,e+2),16));for(e=0,h=0;4>h;h+=1)for(g=0;4>g;g+=1)b[g][h]=c[e],e+=1;return b},toBlocks:function(a,b){var c=[],d=[[],[],[],[]],e=[],f=0,g=0,h=0,i=0,j=0,k=0;for(g=0,i=a.length;i>g;g+=16)c.push(a.substring(g,g+16));for(f=String.fromCharCode(16-c[c.length-1].length);c[c.length-1].length<16;)c[c.length-1]=c[c.length-1]+f;if(!b&&0===f.charCodeAt(0))for(c[c.length]="",g=0,i=16;i>g;g+=1)c[c.length-1]+=String.fromCharCode(16);for(g=0,i=c.length;i>g;g+=1){for(h=0,d=[[],[],[],[]],k=0;4>k;k+=1)for(j=0;4>j;j+=1)d[j][k]=c[g].charCodeAt(h),h+=1;e.push(d)}return e},encrypt:function(a,b,c){var d=[],e=[],f=[],g=[],h=[],i=[],j=0,k=!1,l=0,m=0,n=0,o=0,p=0,q=0;if(a.input=a.plaintext||a.ciphertext,k=this.error({opts:{variable:a,conditions:[void 0,!1],message:"Missing variables"},"opts.input":{variable:a.input,conditions:[void 0,!1,""],message:"Missing input"},"opts.key":{variable:a.key,conditions:[void 0,!1,""],message:"Missing key"},"opts.iv":{variable:a.iv,conditions:[void 0,!1,""],message:"Missing initialization vector"}}))return!1;for(d=this.toBlocks(a.input,c),e=this.keySchedule(this.toKey(a.key),10),f=this.toKey(a.iv),l=0,m=d.length;m>l;l+=1){if(g=this.clone(d[l]),c){for(g=this.subBytes(this.shiftRows(this.addRoundKey(g,e[10]),!0),!0),n=9,o=1;n>=o;n-=1)g=this.subBytes(this.shiftRows(this.mixColumns(this.addRoundKey(g,e[n]),!0),!0),!0);g=this.addRoundKey(g,e[n]),g=this.blockXOR(g,0===l?f:d[l-1])}else{for(g=this.blockXOR(g,0===l?f:h[h.length-1]),g=this.addRoundKey(g,e[0]),n=1,o=9;o>=n;n+=1)g=this.addRoundKey(this.mixColumns(this.shiftRows(this.subBytes(g))),e[n]);g=this.addRoundKey(this.shiftRows(this.subBytes(g)),e[n])}h.push(g)}for(l=0,o=h.length;o>l;l+=1)for(p=0;p<h[l].length;p+=1)for(q=0;q<h[l].length;q+=1)i.push(h[l][q][p]);return c&&(j=i[i.length-1],i[i.length-j]===j&&(i=i.slice(0,i.length-j))),this.output(i,b)},decrypt:function(a,b){return this.encrypt(a,b,!0)}};!function(){var b=0,c=[],d=0,e=0,f=0;for(d=0;256>d;d+=1)c[d]=128>d?d<<1:d<<1^283;for(d=0;256>d;d+=1)b=f^f<<1^f<<2^f<<3^f<<4,b=b>>>8^255&b^99,a.sbox.norm[e]=b,a.sbox.inv[b]=e,e?(e=c[e]^c[c[c[c[c[c[e]]]^c[e]]]],f^=c[c[f]]):(e=1,f=1)}(),"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=a:(window.JES=a,"function"==typeof define&&define.amd&&define("JES",[],function(){return a}))}();